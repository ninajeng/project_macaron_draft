"use strict";(self["webpackChunkproject_macaron"]=self["webpackChunkproject_macaron"]||[]).push([[740],{4735:function(t,e,l){l.d(e,{Z:function(){return b}});var a=l(3396),o=l(7139);const s={class:"modal fade",id:"delModal",tabindex:"-1",ref:"delModal"},i={class:"modal-dialog"},d={class:"modal-content"},r={class:"modal-header bg-danger text-white"},n={class:"modal-title"},c={class:"modal-body"},u={class:"modal-footer"};function m(t,e,l,m,p,h){return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",i,[(0,a._)("div",d,[(0,a._)("div",r,[(0,a._)("h5",n,"確認刪除"+(0,o.zw)(l.item)+"："+(0,o.zw)(l.deleteItem.title),1),(0,a._)("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...t)=>h.hideModal&&h.hideModal(...t))})]),(0,a._)("div",c,[(0,a._)("p",null,'刪除"'+(0,o.zw)(l.deleteItem.title)+'"？ (刪除後將無法復原)',1)]),(0,a._)("div",u,[(0,a._)("button",{type:"button",class:"btn btn-outline-gray",onClick:e[1]||(e[1]=(...t)=>h.hideModal&&h.hideModal(...t))}," 取消 "),(0,a._)("button",{type:"button",class:"btn btn-danger",onClick:e[2]||(e[2]=t=>this.$emit("delete"))}," 確認 ")])])])],512)}var p=l(3455),h={data(){return{modal:{}}},props:["deleteItem","item"],emits:["delete"],methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()}},mounted(){this.modal=new p.Modal(this.$refs.delModal)}},g=l(89);const _=(0,g.Z)(h,[["render",m]]);var b=_},1740:function(t,e,l){l.r(e),l.d(e,{default:function(){return It}});var a=l(3396),o=l(7139);const s={class:"d-flex justify-content-between pt-4 py-3"},i=(0,a._)("h2",{class:"m-0 text-secondary fw-bolder"},"產品列表",-1),d={class:"table table-hover align-middle"},r=(0,a._)("thead",{class:"border-dark"},[(0,a._)("tr",null,[(0,a._)("th",{width:"150"},"類別"),(0,a._)("th",null,"產品名稱"),(0,a._)("th",{width:"150",class:"text-end"},"原價"),(0,a._)("th",{width:"150",class:"text-end"},"售價"),(0,a._)("th",{width:"100",class:"text-end"},"是否啟用"),(0,a._)("th",{width:"150",class:"text-center"},"編輯/刪除")])],-1),n={class:"text-end"},c={class:"text-end"},u={class:"text-center"},m={class:"btn-group btn-group-sm",role:"group","aria-label":"Basic example"},p=["onClick"],h=["onClick"];function g(t,e,l,g,_,b){const f=(0,a.up)("LoadingVue"),y=(0,a.up)("productModal"),v=(0,a.up)("deleteModal"),w=(0,a.up)("pagination");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(f,{active:_.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,a.Wm)(y,{ref:"productModal","temp-product":_.temp,onUpdateProduct:b.updateProduct,onCreateProduct:b.createProduct},null,8,["temp-product","onUpdateProduct","onCreateProduct"]),(0,a.Wm)(v,{ref:"deleteModal","delete-item":_.deleteProduct,item:"產品",onDelete:b.deleteId},null,8,["delete-item","onDelete"]),(0,a._)("div",s,[i,(0,a._)("button",{type:"button",class:"btn btn-success align-self-center me-5",onClick:e[0]||(e[0]=t=>b.editProduct())}," 新增 ")]),(0,a._)("table",d,[r,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(_.products,((e,l)=>((0,a.wg)(),(0,a.iD)("tr",{key:"product"+l},[(0,a._)("td",null,(0,o.zw)(e.category),1),(0,a._)("td",null,(0,o.zw)(e.title),1),(0,a._)("td",n,(0,o.zw)(t.$filters.currency(e.origin_price)),1),(0,a._)("td",c,(0,o.zw)(t.$filters.currency(e.price)),1),(0,a._)("td",{class:(0,o.C_)(["text-end text-muted",{"text-success":e.is_enabled}])},(0,o.zw)(e.is_enabled?"啟用":"未啟用"),3),(0,a._)("td",u,[(0,a._)("div",m,[(0,a._)("button",{type:"button",class:"btn btn-outline-success",onClick:t=>b.editProduct(e)}," 編輯 ",8,p),(0,a._)("button",{type:"button",class:"btn btn-outline-danger",onClick:t=>b.deleteConfirm(e)}," 刪除 ",8,h)])])])))),128))])]),(0,a.Wm)(w,{"page-info":_.pageInfo,onSetPage:b.getData},null,8,["page-info","onSetPage"])],64)}l(560);var _=l(9242);const b={class:"modal fade",id:"productModal",tabindex:"-1",ref:"productModal"},f={class:"modal-dialog modal-xl modal-dialog-scrollable"},y={class:"modal-content"},v={class:"modal-header bg-secondary"},w={class:"modal-title fs-5 text-white"},U={class:"modal-body"},M={class:"row"},x={class:"col-4"},k={class:"mb-3"},$=(0,a._)("p",null,"產品主要圖片",-1),C={key:0},P=["src","alt"],D={class:"input-group mb-3"},L={key:1},V={class:"mb-3"},F=(0,a._)("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),z={class:"mb-3"},I=(0,a._)("label",{for:"imageFile",class:"form-label"},"上傳圖片",-1),j=(0,a._)("hr",null,null,-1),q={key:0},Z=["src","alt"],W={class:"input-group mb-3"},H=["onClick"],S=["onUpdate:modelValue"],Y=["onClick"],J={key:1},K={class:"mb-3"},N=["for"],O=["name","id","onUpdate:modelValue"],B={class:"mb-3"},T=["for"],A=["name","id","onChange"],E={class:"mb-3"},G=["onClick"],Q=(0,a._)("hr",null,null,-1),R={key:0,class:"mb-3"},X={class:"col-8"},tt={class:"mb-3"},et=(0,a._)("label",{for:"title",class:"form-label"},"標題*",-1),lt={class:"mb-3"},at={class:"row"},ot={class:"col"},st=(0,a._)("label",{for:"category",class:"form-label"},"分類*",-1),it={class:"col"},dt=(0,a._)("label",{for:"unit",class:"form-label"},"單位*",-1),rt={class:"mb-4"},nt={class:"row"},ct={class:"col"},ut=(0,a._)("label",{for:"origin_price",class:"form-label"},"原價*",-1),mt={class:"col"},pt=(0,a._)("label",{for:"price",class:"form-label"},"售價*",-1),ht=(0,a._)("hr",null,null,-1),gt={class:"mb-3"},_t=(0,a._)("label",{for:"description",class:"form-label"},"產品描述",-1),bt={class:"mb-3"},ft=(0,a._)("label",{for:"content",class:"form-label"},"說明內容",-1),yt={class:"form-check mb-3"},vt=["checked"],wt=(0,a._)("label",{for:"is_enabled",class:"form-check-label"},"是否啟用*",-1),Ut={class:"modal-footer"};function Mt(t,e,l,s,i,d){const r=(0,a.up)("LoadingVue");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(r,{active:i.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,a._)("div",b,[(0,a._)("div",f,[(0,a._)("div",y,[(0,a._)("div",v,[(0,a._)("h1",w,(0,o.zw)(i.product.id?"編輯產品":"新增產品"),1),(0,a._)("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...t)=>d.hideModal&&d.hideModal(...t))})]),(0,a._)("div",U,[(0,a._)("div",M,[(0,a._)("div",x,[(0,a._)("div",k,[$,i.product.imageUrl?((0,a.wg)(),(0,a.iD)("div",C,[(0,a._)("img",{src:i.product.imageUrl,alt:i.product.title,class:"img-fluid mb-2"},null,8,P),(0,a._)("div",D,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control imagesList","onUpdate:modelValue":e[1]||(e[1]=t=>i.product.imageUrl=t)},null,512),[[_.nr,i.product.imageUrl]]),(0,a._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=t=>i.product.imageUrl="")}," 重新上傳 ")])])):((0,a.wg)(),(0,a.iD)("div",L,[(0,a._)("div",V,[F,(0,a.wy)((0,a._)("input",{type:"text",name:"imageUrl",id:"imageUrl",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[3]||(e[3]=t=>i.product.imageUrl=t)},null,512),[[_.nr,i.product.imageUrl]])]),(0,a._)("div",z,[I,(0,a._)("input",{type:"file",name:"imageFile",id:"imageFile",class:"form-control",ref:"imageFile_main",onChange:e[4]||(e[4]=t=>d.uploadFile(!0))},null,544)])]))]),j,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.product.imagesUrl,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{key:"url"+e},[(0,a._)("p",null,"產品其他圖片 - "+(0,o.zw)(e+1),1),t?((0,a.wg)(),(0,a.iD)("div",q,[(0,a._)("img",{src:t,alt:`${i.product.title}-其他圖片${e+1}`,class:"img-fluid mb-2"},null,8,Z),(0,a._)("div",W,[(0,a._)("button",{type:"button",class:"btn btn-outline-danger",onClick:t=>d.deleteImage(e)}," 刪除欄位 ",8,H),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control imagesList","onUpdate:modelValue":t=>i.product.imagesUrl[e]=t},null,8,S),[[_.nr,i.product.imagesUrl[e]]]),(0,a._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t=>i.product.imagesUrl[e]=""}," 重新上傳 ",8,Y)])])):((0,a.wg)(),(0,a.iD)("div",J,[(0,a._)("div",K,[(0,a._)("label",{for:`imageUrl_${e}`,class:"form-label"},"輸入圖片網址",8,N),(0,a.wy)((0,a._)("input",{type:"text",name:`imageUrl_${e}`,id:`imageUrl_${e}`,class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":t=>i.product.imagesUrl[e]=t},null,8,O),[[_.nr,i.product.imagesUrl[e]]])]),(0,a._)("div",B,[(0,a._)("label",{for:`imageFile_${e}`,class:"form-label"},"上傳圖片",8,T),(0,a._)("input",{type:"file",name:`imageFile_${e}`,id:`imageFile_${e}`,class:"form-control",ref_for:!0,ref:"imageFile"+e,onChange:t=>d.uploadFile(!1,e)},null,40,A)]),(0,a._)("div",E,[(0,a._)("button",{type:"button",class:"btn btn-outline-danger",onClick:t=>d.deleteImage(e)}," 刪除欄位 ",8,G)])])),Q])))),128)),!i.product.imagesUrl||i.product.imagesUrl.length<5?((0,a.wg)(),(0,a.iD)("div",R,[(0,a._)("button",{type:"button",class:"btn btn-outline-primary w-100",onClick:e[5]||(e[5]=t=>i.product.imagesUrl.push(""))}," 新增圖片欄位 ")])):(0,a.kq)("",!0)]),(0,a._)("div",X,[(0,a._)("div",tt,[et,(0,a.wy)((0,a._)("input",{type:"text",name:"title",id:"title",class:"form-control",placeholder:"請輸入產品標題","onUpdate:modelValue":e[6]||(e[6]=t=>i.product.title=t),required:""},null,512),[[_.nr,i.product.title]])]),(0,a._)("div",lt,[(0,a._)("div",at,[(0,a._)("div",ot,[st,(0,a.wy)((0,a._)("input",{type:"text",name:"category",id:"category",class:"form-control",placeholder:"請輸入產品分類","onUpdate:modelValue":e[7]||(e[7]=t=>i.product.category=t),required:""},null,512),[[_.nr,i.product.category]])]),(0,a._)("div",it,[dt,(0,a.wy)((0,a._)("input",{type:"text",name:"unit",id:"unit",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[8]||(e[8]=t=>i.product.unit=t),required:""},null,512),[[_.nr,i.product.unit]])])])]),(0,a._)("div",rt,[(0,a._)("div",nt,[(0,a._)("div",ct,[ut,(0,a.wy)((0,a._)("input",{type:"num",name:"origin_price",id:"origin_price",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[9]||(e[9]=t=>i.product.origin_price=t),required:""},null,512),[[_.nr,i.product.origin_price,void 0,{number:!0}]])]),(0,a._)("div",mt,[pt,(0,a.wy)((0,a._)("input",{type:"num",name:"price",id:"price",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[10]||(e[10]=t=>i.product.price=t),required:""},null,512),[[_.nr,i.product.price,void 0,{number:!0}]])])])]),ht,(0,a._)("div",gt,[_t,(0,a.wy)((0,a._)("textarea",{name:"description",id:"description",rows:"2",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[11]||(e[11]=t=>i.product.description=t)},null,512),[[_.nr,i.product.description]])]),(0,a._)("div",bt,[ft,(0,a.wy)((0,a._)("textarea",{name:"content",id:"content",rows:"2",class:"form-control",placeholder:"請輸入產品說明內容","onUpdate:modelValue":e[12]||(e[12]=t=>i.product.content=t)},null,512),[[_.nr,i.product.content]])]),(0,a._)("div",yt,[(0,a.wy)((0,a._)("input",{type:"checkbox",name:"is_enabled",id:"is_enabled",class:"form-check-input active","onUpdate:modelValue":e[13]||(e[13]=t=>i.product.is_enabled=t),checked:1===i.product.is_enabled},null,8,vt),[[_.e8,i.product.is_enabled]]),wt])])])]),(0,a._)("div",Ut,[(0,a._)("button",{type:"button",class:"btn btn-outline-gray",onClick:e[14]||(e[14]=(...t)=>d.hideModal&&d.hideModal(...t))}," 取消 "),(0,a._)("button",{type:"button",class:"btn btn-secondary",onClick:e[15]||(e[15]=(...t)=>d.updateProduct&&d.updateProduct(...t))},(0,o.zw)(i.product.id?"更新":"新增"),1)])])])],512)],64)}var xt=l(7972),kt=l.n(xt),$t={data(){return{modal:{},product:{},isLoading:!1}},props:["tempProduct"],emits:["updateProduct","createProduct"],watch:{tempProduct(){this.getData()}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide(),this.getData()},getData(){this.product=JSON.parse(JSON.stringify(this.tempProduct)),this.product.imagesUrl||(this.product.imagesUrl=[])},updateProduct(){if(this.product.imagesUrl)for(let t=this.product.imagesUrl.length-1;t>-1;t--)""===this.product.imagesUrl[t]&&this.product.imagesUrl.splice(t,1);this.product.id?this.$emit("updateProduct",this.product):this.$emit("createProduct",this.product)},uploadFile(t,e=0){let l;this.isLoading=!0,l=t?this.$refs.imageFile_main.files[0]:this.$refs[`imageFile${e}`][0].files[0];const a=new FormData,o="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/upload";a.append("file-to-upload",l),this.axios.post(o,a).then((a=>{this.isLoading=!1,a.data.success?(t?this.product.imageUrl=a.data.imageUrl:(this.product.imagesUrl||(this.product.imagesUrl=[]),this.product.imagesUrl[e]=a.data.imageUrl),l=void 0):alert(a.data.message.code||a.data.message)}))},deleteImage(t){this.product.imagesUrl.splice(t,1)}},mounted(){this.modal=new(kt())(this.$refs.productModal,{backdrop:"static"})}},Ct=l(89);const Pt=(0,Ct.Z)($t,[["render",Mt]]);var Dt=Pt,Lt=l(4735),Vt=l(6567),Ft={data(){return{products:[],temp:{},deleteProduct:{},isLoading:!1,pageInfo:{}}},components:{productModal:Dt,deleteModal:Lt.Z,pagination:Vt.Z},inject:["emitter"],methods:{getData(t=1){this.isLoading=!0,window.scrollTo({top:0});const e=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/products?page=${t}`;this.axios.get(e).then((t=>{this.isLoading=!1,t.data.success?(this.products=t.data.products,this.pageInfo=t.data.pagination):alert(t.data.message)})).catch((t=>{alert(t)}))},editProduct(t={}){this.temp=t,this.$refs.productModal.showModal()},updateProduct(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product/${t.id}`;this.axios.put(e,{data:t}).then((e=>{this.isLoading=!1,e.data.success?(this.emitter.emit("sendMsg",{message:`已更新產品：${t.title}`,status:"success"}),this.$refs.productModal.hideModal(),this.getData()):this.emitter.emit("sendMsg",{message:e.data.message.join(", "),status:"error",title:"產品更新失敗"})})).catch((t=>{this.emitter.emit("sendMsg",{message:t,status:"error",title:"產品更新失敗"})}))},createProduct(t){this.isLoading=!0;const e="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product";this.axios.post(e,{data:t}).then((e=>{this.isLoading=!1,e.data.success?(this.emitter.emit("sendMsg",{message:`已新增產品：${t.title}`,status:"success"}),this.$refs.productModal.hideModal(),this.getData()):this.emitter.emit("sendMsg",{message:e.data.message.join(", "),status:"error",title:"產品新增失敗"})})).catch((t=>{this.emitter.emit("sendMsg",{message:t,status:"error",title:"產品新增失敗"})}))},deleteConfirm(t){this.deleteProduct=t,this.$refs.deleteModal.showModal()},deleteId(){this.isLoading=!0,this.$refs.deleteModal.hideModal();const t=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product/${this.deleteProduct.id}`;this.axios.delete(t).then((t=>{this.isLoading=!1,t.data.success?this.emitter.emit("sendMsg",{message:`已刪除產品：${this.deleteProduct.title}`,status:"success"}):this.emitter.emit("sendMsg",{message:`${t.data.message}`,status:"error",title:"產品刪除失敗"}),this.getData(this.pageInfo.current_page)})).catch((t=>{this.emitter.emit("sendMsg",{message:`${t}`,status:"error",title:"產品刪除失敗"})}))}},created(){this.getData()}};const zt=(0,Ct.Z)(Ft,[["render",g]]);var It=zt}}]);
//# sourceMappingURL=740.114698d2.js.map