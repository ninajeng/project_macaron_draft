"use strict";(self["webpackChunkproject_macaron"]=self["webpackChunkproject_macaron"]||[]).push([[83],{5083:function(t,e,a){a.r(e),a.d(e,{default:function(){return It}});var s=a(3396),l=a(7139);const o={class:"d-flex justify-content-between pt-4 py-3 pe-2"},i=(0,s._)("h2",{class:"m-0 text-secondary fw-bolder"},"產品列表",-1),r={class:"table table-hover align-middle"},d=(0,s._)("thead",{class:"border-dark"},[(0,s._)("tr",null,[(0,s._)("th",{width:"150"},"類別"),(0,s._)("th",null,"產品名稱"),(0,s._)("th",{width:"150",class:"text-end"},"原價"),(0,s._)("th",{width:"150",class:"text-end"},"售價"),(0,s._)("th",{width:"100",class:"text-end"},"是否啟用"),(0,s._)("th",{width:"150",class:"text-center"},"編輯/刪除")])],-1),c={class:"text-end"},n={class:"text-end"},u={class:"text-center"},p={class:"btn-group btn-group-sm",role:"group","aria-label":"Basic example"},m=["onClick"],h=["onClick"];function g(t,e,a,g,_,b){const f=(0,s.up)("LoadingVue"),y=(0,s.up)("productModal"),v=(0,s.up)("deleteModal"),w=(0,s.up)("pagination");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(f,{active:_.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,s.Wm)(y,{ref:"productModal","temp-product":_.temp,onUpdateProduct:b.updateProduct,onCreateProduct:b.createProduct},null,8,["temp-product","onUpdateProduct","onCreateProduct"]),(0,s.Wm)(v,{ref:"deleteModal","delete-item":_.deleteProduct,item:"產品",onDelete:b.deleteId},null,8,["delete-item","onDelete"]),(0,s._)("div",o,[i,(0,s._)("button",{type:"button",class:"btn btn-secondary align-self-center me-4",onClick:e[0]||(e[0]=t=>b.editProduct())}," 新增產品 ")]),(0,s._)("table",r,[d,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(_.products,((e,a)=>((0,s.wg)(),(0,s.iD)("tr",{key:"product"+a},[(0,s._)("td",null,(0,l.zw)(e.category),1),(0,s._)("td",null,(0,l.zw)(e.title),1),(0,s._)("td",c,(0,l.zw)(t.$filters.currency(e.origin_price)),1),(0,s._)("td",n,(0,l.zw)(t.$filters.currency(e.price)),1),(0,s._)("td",{class:(0,l.C_)(["text-end text-muted",{"text-success":e.is_enabled}])},(0,l.zw)(e.is_enabled?"啟用":"未啟用"),3),(0,s._)("td",u,[(0,s._)("div",p,[(0,s._)("button",{type:"button",class:"btn btn-outline-success",onClick:t=>b.editProduct(e)}," 編輯 ",8,m),(0,s._)("button",{type:"button",class:"btn btn-outline-danger",onClick:t=>b.deleteConfirm(e)}," 刪除 ",8,h)])])])))),128))])]),(0,s.Wm)(w,{"page-info":_.pageInfo,onSetPage:b.getData},null,8,["page-info","onSetPage"])],64)}a(560);var _=a(9242);const b={class:"modal fade",id:"productModal",tabindex:"-1",ref:"productModal"},f={class:"modal-dialog modal-xl modal-dialog-scrollable"},y={class:"modal-content"},v={class:"modal-header bg-secondary"},w={class:"modal-title fs-5 text-white"},U={class:"modal-body"},k={class:"row"},x={class:"col-4"},M={class:"mb-3"},$=(0,s._)("p",null,"產品主要圖片",-1),P={key:0},C=["src","alt"],D={class:"input-group mb-3"},L={key:1},F={class:"mb-3"},V=(0,s._)("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),z={class:"mb-3"},I=(0,s._)("label",{for:"imageFile",class:"form-label"},"上傳圖片",-1),j=(0,s._)("hr",null,null,-1),q={key:0},W=["src","alt"],H={class:"input-group mb-3"},S=["onClick"],Y=["onUpdate:modelValue"],Z=["onClick"],E={key:1},J={class:"mb-3"},K=["for"],N=["name","id","onUpdate:modelValue"],O={class:"mb-3"},B=["for"],T=["name","id","onChange"],A={class:"mb-3"},G=["onClick"],Q=(0,s._)("hr",null,null,-1),R={key:0,class:"mb-3"},X={class:"col-8"},tt={class:"mb-3"},et=(0,s._)("label",{for:"title",class:"form-label"},"標題*",-1),at={class:"mb-3"},st={class:"row"},lt={class:"col"},ot=(0,s._)("label",{for:"category",class:"form-label"},"分類*",-1),it={class:"col"},rt=(0,s._)("label",{for:"unit",class:"form-label"},"單位*",-1),dt={class:"mb-4"},ct={class:"row"},nt={class:"col"},ut=(0,s._)("label",{for:"origin_price",class:"form-label"},"原價*",-1),pt={class:"col"},mt=(0,s._)("label",{for:"price",class:"form-label"},"售價*",-1),ht=(0,s._)("hr",null,null,-1),gt={class:"mb-3"},_t=(0,s._)("label",{for:"description",class:"form-label"},"產品描述",-1),bt={class:"mb-3"},ft=(0,s._)("label",{for:"content",class:"form-label"},"說明內容",-1),yt={class:"form-check mb-3"},vt=["checked"],wt=(0,s._)("label",{for:"is_enabled",class:"form-check-label"},"是否啟用*",-1),Ut={class:"modal-footer"};function kt(t,e,a,o,i,r){const d=(0,s.up)("LoadingVue");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(d,{active:i.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,s._)("div",b,[(0,s._)("div",f,[(0,s._)("div",y,[(0,s._)("div",v,[(0,s._)("h1",w,(0,l.zw)(i.product.id?"編輯產品":"新增產品"),1),(0,s._)("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...t)=>r.hideModal&&r.hideModal(...t))})]),(0,s._)("div",U,[(0,s._)("div",k,[(0,s._)("div",x,[(0,s._)("div",M,[$,i.product.imageUrl?((0,s.wg)(),(0,s.iD)("div",P,[(0,s._)("img",{src:i.product.imageUrl,alt:i.product.title,class:"img-fluid mb-2"},null,8,C),(0,s._)("div",D,[(0,s.wy)((0,s._)("input",{type:"text",class:"form-control imagesList","onUpdate:modelValue":e[1]||(e[1]=t=>i.product.imageUrl=t)},null,512),[[_.nr,i.product.imageUrl]]),(0,s._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=t=>i.product.imageUrl="")}," 重新上傳 ")])])):((0,s.wg)(),(0,s.iD)("div",L,[(0,s._)("div",F,[V,(0,s.wy)((0,s._)("input",{type:"text",name:"imageUrl",id:"imageUrl",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[3]||(e[3]=t=>i.product.imageUrl=t)},null,512),[[_.nr,i.product.imageUrl]])]),(0,s._)("div",z,[I,(0,s._)("input",{type:"file",name:"imageFile",id:"imageFile",class:"form-control",ref:"imageFile_main",onChange:e[4]||(e[4]=t=>r.uploadFile(!0))},null,544)])]))]),j,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.product.imagesUrl,((t,e)=>((0,s.wg)(),(0,s.iD)("div",{key:"url"+e},[(0,s._)("p",null,"產品其他圖片 - "+(0,l.zw)(e+1),1),t?((0,s.wg)(),(0,s.iD)("div",q,[(0,s._)("img",{src:t,alt:`${i.product.title}-其他圖片${e+1}`,class:"img-fluid mb-2"},null,8,W),(0,s._)("div",H,[(0,s._)("button",{type:"button",class:"btn btn-outline-danger",onClick:t=>r.deleteImage(e)}," 刪除欄位 ",8,S),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control imagesList","onUpdate:modelValue":t=>i.product.imagesUrl[e]=t},null,8,Y),[[_.nr,i.product.imagesUrl[e]]]),(0,s._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t=>i.product.imagesUrl[e]=""}," 重新上傳 ",8,Z)])])):((0,s.wg)(),(0,s.iD)("div",E,[(0,s._)("div",J,[(0,s._)("label",{for:`imageUrl_${e}`,class:"form-label"},"輸入圖片網址",8,K),(0,s.wy)((0,s._)("input",{type:"text",name:`imageUrl_${e}`,id:`imageUrl_${e}`,class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":t=>i.product.imagesUrl[e]=t},null,8,N),[[_.nr,i.product.imagesUrl[e]]])]),(0,s._)("div",O,[(0,s._)("label",{for:`imageFile_${e}`,class:"form-label"},"上傳圖片",8,B),(0,s._)("input",{type:"file",name:`imageFile_${e}`,id:`imageFile_${e}`,class:"form-control",ref_for:!0,ref:"imageFile"+e,onChange:t=>r.uploadFile(!1,e)},null,40,T)]),(0,s._)("div",A,[(0,s._)("button",{type:"button",class:"btn btn-outline-danger",onClick:t=>r.deleteImage(e)}," 刪除欄位 ",8,G)])])),Q])))),128)),!i.product.imagesUrl||i.product.imagesUrl.length<5?((0,s.wg)(),(0,s.iD)("div",R,[(0,s._)("button",{type:"button",class:"btn btn-outline-primary w-100",onClick:e[5]||(e[5]=t=>i.product.imagesUrl.push(""))}," 新增圖片欄位 ")])):(0,s.kq)("",!0)]),(0,s._)("div",X,[(0,s._)("div",tt,[et,(0,s.wy)((0,s._)("input",{type:"text",name:"title",id:"title",class:"form-control",placeholder:"請輸入產品標題","onUpdate:modelValue":e[6]||(e[6]=t=>i.product.title=t),required:""},null,512),[[_.nr,i.product.title]])]),(0,s._)("div",at,[(0,s._)("div",st,[(0,s._)("div",lt,[ot,(0,s.wy)((0,s._)("input",{type:"text",name:"category",id:"category",class:"form-control",placeholder:"請輸入產品分類","onUpdate:modelValue":e[7]||(e[7]=t=>i.product.category=t),required:""},null,512),[[_.nr,i.product.category]])]),(0,s._)("div",it,[rt,(0,s.wy)((0,s._)("input",{type:"text",name:"unit",id:"unit",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[8]||(e[8]=t=>i.product.unit=t),required:""},null,512),[[_.nr,i.product.unit]])])])]),(0,s._)("div",dt,[(0,s._)("div",ct,[(0,s._)("div",nt,[ut,(0,s.wy)((0,s._)("input",{type:"num",name:"origin_price",id:"origin_price",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[9]||(e[9]=t=>i.product.origin_price=t),required:""},null,512),[[_.nr,i.product.origin_price,void 0,{number:!0}]])]),(0,s._)("div",pt,[mt,(0,s.wy)((0,s._)("input",{type:"num",name:"price",id:"price",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[10]||(e[10]=t=>i.product.price=t),required:""},null,512),[[_.nr,i.product.price,void 0,{number:!0}]])])])]),ht,(0,s._)("div",gt,[_t,(0,s.wy)((0,s._)("textarea",{name:"description",id:"description",rows:"2",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[11]||(e[11]=t=>i.product.description=t)},null,512),[[_.nr,i.product.description]])]),(0,s._)("div",bt,[ft,(0,s.wy)((0,s._)("textarea",{name:"content",id:"content",rows:"2",class:"form-control",placeholder:"請輸入產品說明內容","onUpdate:modelValue":e[12]||(e[12]=t=>i.product.content=t)},null,512),[[_.nr,i.product.content]])]),(0,s._)("div",yt,[(0,s.wy)((0,s._)("input",{type:"checkbox",name:"is_enabled",id:"is_enabled",class:"form-check-input active","onUpdate:modelValue":e[13]||(e[13]=t=>i.product.is_enabled=t),checked:1===i.product.is_enabled},null,8,vt),[[_.e8,i.product.is_enabled]]),wt])])])]),(0,s._)("div",Ut,[(0,s._)("button",{type:"button",class:"btn btn-outline-gray",onClick:e[14]||(e[14]=(...t)=>r.hideModal&&r.hideModal(...t))}," 取消 "),(0,s._)("button",{type:"button",class:"btn btn-secondary",onClick:e[15]||(e[15]=(...t)=>r.updateProduct&&r.updateProduct(...t))},(0,l.zw)(i.product.id?"更新":"新增"),1)])])])],512)],64)}var xt=a(7972),Mt=a.n(xt),$t={data(){return{modal:{},product:{},isLoading:!1}},props:["tempProduct"],emits:["updateProduct","createProduct"],inject:["emitter"],watch:{tempProduct(){this.getData()}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide(),this.getData()},getData(){this.product=JSON.parse(JSON.stringify(this.tempProduct)),this.product.imagesUrl||(this.product.imagesUrl=[])},updateProduct(){const t=this.checkFormatError().join("、");if(t)this.emitter.emit("sendMsg",{message:t,status:"error",title:"資料格式錯誤"});else{if(this.product.imagesUrl)for(let t=this.product.imagesUrl.length-1;t>-1;t--)""===this.product.imagesUrl[t]&&this.product.imagesUrl.splice(t,1);this.product.id?this.$emit("updateProduct",this.product):this.$emit("createProduct",this.product)}},checkFormatError(){const t=[];return this.product.title||t.push("標題欄位為必填"),this.product.category||t.push("分類欄位為必填"),this.product.unit||t.push("單位欄位為必填"),this.product.origin_price?"number"!==typeof this.product.origin_price&&t.push("原價欄位需填寫數字"):t.push("原價欄位為必填"),this.product.price?"number"!==typeof this.product.price&&t.push("售價欄位需填寫數字"):t.push("售價欄位為必填"),t},uploadFile(t,e=0){let a;this.isLoading=!0,a=t?this.$refs.imageFile_main.files[0]:this.$refs[`imageFile${e}`][0].files[0];const s=new FormData,l="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/upload";s.append("file-to-upload",a),this.axios.post(l,s).then((s=>{this.isLoading=!1,s.data.success?(t?this.product.imageUrl=s.data.imageUrl:(this.product.imagesUrl||(this.product.imagesUrl=[]),this.product.imagesUrl[e]=s.data.imageUrl),a=void 0):alert(s.data.message.code||s.data.message)}))},deleteImage(t){this.product.imagesUrl.splice(t,1)}},mounted(){this.modal=new(Mt())(this.$refs.productModal,{backdrop:"static"})}},Pt=a(89);const Ct=(0,Pt.Z)($t,[["render",kt]]);var Dt=Ct,Lt=a(81),Ft=a(6567),Vt={data(){return{products:[],temp:{},deleteProduct:{},isLoading:!1,pageInfo:{}}},components:{productModal:Dt,deleteModal:Lt.Z,pagination:Ft.Z},inject:["emitter"],methods:{getData(t=1){this.isLoading=!0,window.scrollTo({top:0});const e=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/products?page=${t}`;this.axios.get(e).then((t=>{this.isLoading=!1,t.data.success?(this.products=t.data.products,this.pageInfo=t.data.pagination):alert(t.data.message)})).catch((t=>{alert(t)}))},editProduct(t={}){this.temp=t,this.$refs.productModal.showModal()},updateProduct(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product/${t.id}`;this.axios.put(e,{data:t}).then((e=>{this.isLoading=!1,e.data.success?(this.emitter.emit("sendMsg",{message:`已更新產品：${t.title}`,status:"success"}),this.$refs.productModal.hideModal(),this.getData()):this.emitter.emit("sendMsg",{message:e.data.message.join(", "),status:"error",title:"產品更新失敗"})})).catch((t=>{this.emitter.emit("sendMsg",{message:t,status:"error",title:"產品更新失敗"})}))},createProduct(t){this.isLoading=!0;const e="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product";this.axios.post(e,{data:t}).then((e=>{this.isLoading=!1,e.data.success?(this.emitter.emit("sendMsg",{message:`已新增產品：${t.title}`,status:"success"}),this.$refs.productModal.hideModal(),this.getData()):this.emitter.emit("sendMsg",{message:e.data.message.join(", "),status:"error",title:"產品新增失敗"})})).catch((t=>{this.emitter.emit("sendMsg",{message:t,status:"error",title:"產品新增失敗"})}))},deleteConfirm(t){this.deleteProduct=t,this.$refs.deleteModal.showModal()},deleteId(){this.isLoading=!0,this.$refs.deleteModal.hideModal();const t=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product/${this.deleteProduct.id}`;this.axios.delete(t).then((t=>{this.isLoading=!1,t.data.success?this.emitter.emit("sendMsg",{message:`已刪除產品：${this.deleteProduct.title}`,status:"success"}):this.emitter.emit("sendMsg",{message:`${t.data.message}`,status:"error",title:"產品刪除失敗"}),this.getData(this.pageInfo.current_page)})).catch((t=>{this.emitter.emit("sendMsg",{message:`${t}`,status:"error",title:"產品刪除失敗"})}))}},created(){this.getData()}};const zt=(0,Pt.Z)(Vt,[["render",g]]);var It=zt}}]);
//# sourceMappingURL=83.cafbbbf5.js.map